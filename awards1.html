<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel='shortcut icon' type='image/x-icon' href='imgs/favicon.ico' />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <title>Royal Gospel Music | You Want It, We Got It</title>
    <link rel="stylesheet" type="text/css" href="pearl.css">
    <link rel="stylesheet" type="text/css" href="awards.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.1.9/sweetalert2.min.js" integrity="sha512-I/i/QdEAXhCk1O0kmm/I/qf5nwNRv5fYAlnWVZRd+dAfYgZAKeIrIy7vlr6J1di+HauR+5bzS6m/iHoR8xRYCA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.1.9/sweetalert2.css" integrity="sha512-NIcYVd9x+7QWzVOrAepi4tT6Y17n9yiq7Jzc4T6FfSXPiI/+oB1j298Hufjj+Hr/9tjz9p0mSolx/OBRVPStLw==" crossorigin="anonymous" referrerpolicy="no-referrer"
    />

    <!-- Include a polyfill for ES6 Promises (optional) for IE11 and Android browser -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/core-js/2.4.1/core.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CHEK379PB8"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'G-CHEK379PB8');
    </script>
    <script>
        // document.getElementById('vote_button').style.display = 'none';
    </script>
</head>

<body>
    <header>
        <nav class="navbar navbar-expand-lg">
            <div class="container mb-4">
                <a class="navbar-brand" href="index.html">
                    <img src="imgs/rgm_logo.png" style="width:50px;">
                </a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <i class="fas fa-bars" style="color: white;"></i>
            </button>

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">Home</a>
                        </li>
                        
                         <li class="nav-item">
                            <a class="nav-link" href="awards.html">Awards</a>
                        </li>
                        <!--<li class="nav-item">-->
                        <!--    <a class="nav-link" href="index.html">Download</a>-->
                        <!--</li>-->
                        <!--<li class="nav-item">-->
                        <!--    <a class="nav-link" href="index.html">Artists</a>-->
                        <!--</li>-->
                        <!--<li class="nav-item">-->
                        <!--    <a class="nav-link" href="index.html">Events</a>-->
                        <!--</li>-->
                        <!--<li class="nav-item">-->
                        <!--    <a class="nav-link" href="index.html">About Us</a>-->
                        <!--</li>-->
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <main>
        <article>
            <section>
                <div class="index_article1">
                    <!--<h5 class="text-center mb-4" style="color: #FFEDBF;">Royal Gospel Music Awards</h5>-->
                    <div class="text-center mb-3 ">
                        <img class="rgma_img" src="imgs/rgma_logo.png">
                    </div>
                    
                    <span id="all_categories"></span>
                    <div id="category_spinner">
                        <div class="spinner-border text-primary text-center" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                    </div>

                    <div id="vote_button" style="display: none;" >
                        <button  class="btn btn-lg  download-btn"  data-toggle="modal" data-target="#exampleModal" data-whatever="@fat">
                                            Vote
                                        </button>

                    </div>
                </div>
            </section>
        </article>

        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 style="text-align:center !important;" class="modal-title text-center" id="exampleModalLabel">Voting costs UGX 500 only</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="form-group">
                                <label for="names" class="col-form-label">Name:</label>
                                <input type="text" placeholder="Your full names" required class="form-control" id="email">
                            </div>

                            <div class="form-group">
                                <label for="phone-number" class="col-form-label">Phone Number: (Mobile Money) : 07XXX</label>
                                <input type="text" class="form-control" placeholder="Use the format 07XXXX" id="phone-number">

                            </div>
                        </form>
                    </div>
                    <div class="modal-footer footer_btn">
                        <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> -->
                        <button id="vote-btn" type="button" onclick="voteNow()" class="btn btn-primary download-btn">Vote</button>

                        <div style="display:none" id="vote_modal_spinner" class="spinner-border text-primary" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>









    </main>



    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init();
    </script>

    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script>
        // document.getElementById('vote_button').style.display = 'none';
        let categories;
        axios.get('https://api.royalgospelmusic.com/categories/get_all?version=1.0')
            .then(response => {
                // console.log(response)
                categories = response.data.categories;

                // console.table(categories);
                for (category of categories) {

                    let category_nominees = category.nominees;
                    let nominees_html = '';
                    for (nominee of category_nominees) {


                        nominees_html += ` <div style="" class="index_article1_a12 mb-3">
                <div id="${category.id}">
                    <img src="${nominee.photo}" style="width:80px; height:80px; object-fit:cover;  border: 1px solid #FBD263; border-radius:50%">
                    <div class="ml-2">
                        <small style="font-size:14px;">${nominee.name}</small>
                    </div>
                </div>

                <div>
                    <input style="width:1.2em; height:1.2em; background-color:yellow;" border-radius: 0.25em; type="checkbox" id="${nominee.id}" name="${category.id}" value="${nominee.id}" onclick=(onSelectNominee(${category.id},${nominee.id}))>
                </div>
            </div>`;
                    }

                    document.getElementById('all_categories').innerHTML += `
<div data-aos="fade-up" data-aos-duration="600" style="border:2px solid #FBD263; padding:10px; border-radius: 20px; background-color: #050239;" class="container mb-4">
            <h6 class="text-center mb-4 mt-3" style="color:#DFB951; font-weight:bold;">${category.position}. ${category.title}</h6>
            <!-- <br> -->
            ${nominees_html}

        </div>
        

`;
                    document.getElementById('category_spinner').style.display = 'none';
                    document.getElementById('vote_button').style.display = 'flex';
                    // document.getElementById('vote_button').style.display = 'block';


                }


            })
            .catch(error => console.log(error))
        let vote_data = [];
        let categories_voted = [];

        function onSelectNominee(category, nominee) {
          
          
        //   if(categories_voted.length == 32){
        //       document.getElementById('vote_button').disabled = false;
        //   }
          
            //   if(categories_voted.length < 32){
            //     // new Swal("please select atleast one nominee in each category");
            //          new swal({
            //     title: 'Select a nominee in each category ',
            //     text: 'In order to vote successfully, please ensure that you select a nominee in each of the 32 categories ',
                
            // });
            //   }else{
            //       document.getElementById('vote_button').disabled = false;
            //   }
          
          

            let category_index = categories_voted.indexOf(category);
            // console.log(category_index);
            if (category_index > -1) {


                // the user has selected for this category
                // check for its position and replace with new data
                // also as you do this look for the checked input and uncheck it
                // just look for the checked nominee
                // if is the same uncheck
                // if different uncheck the old and check this one
                // then update the vote data
                // remove the vote object using the index
                //

                // this unchecks all
                let checkboxes = document.getElementsByName(category);
                for (var i = 0, n = checkboxes.length; i < n; i++) {
                    checkboxes[i].checked = false;

                }

                // then it checks the selected value
                document.getElementById(nominee).checked = true;




                vote_data.splice(category_index, 1);
                vote_data.push({
                    "category_id": category,
                    "nominee_id": nominee
                });
            } else {
                categories_voted.push(category);
                vote_data.push({
                    "category_id": category,
                    "nominee_id": nominee
                });
            }
            console.table(categories_voted);
            console.table(vote_data);




        }

        function voteNow() {
            // if(categores_voted.length<32){
            //     new swal({
            //     title: 'Select a nominee in each category ',
            //     text: 'In order to vote successfully, please ensure that you select a nominee in each of the 32 categories ',
            //     'warning'
            // });
            
            // alert("hello")
            // }
            //   if(categories_voted.length < 32){
            //     // new Swal("please select atleast one nominee in each category");
            //          new swal({
            //     title: 'Select a nominee in each category ',
            //     text: 'In order to vote successfully, please ensure that you select a nominee in each of the 32 categories ',
                
            // });
            //   }
            
            
            document.getElementById('vote_modal_spinner').style.display = 'block';
            document.getElementById('vote-btn').setAttribute("disabled", "true");
            new swal({
                title: 'Vote transaction initiated',
                text: 'please complete the transaction with your pin',
            })
            swal.showLoading()

            let phone = document.getElementById('phone-number').value;
            let email = document.getElementById('email').value;
            let data = {
                "user_id": phone,
                "names":email,
                "votes": vote_data
            }
            axios.post('https://api.royalgospelmusic.com/awards/vote', data)
                .then(function(response) {
                    console.log(response);
                    document.getElementById('vote_modal_spinner').style.display = 'none';
                    document.getElementById('vote-btn').setAttribute("disabled", "false");

                    if (response.data.success == true) {
                        new swal(
                            'Thank you!',
                            'Voting Successful, looking forward to the main event on 11th Dec 2021 ðŸ¤©',
                            'success'
                        )
                    } else {
                        if (response.data.message == "USER_ALREADY_VOTED") {
                            new swal(
                                'ðŸ¤¦ðŸ¾â€â™‚ï¸',
                                'Sorry you already voted!, We are looking forward to the main event on 11th Dec 2021. Shalom!',
                                'warning'
                            )
                        }else if(response.data.message == "TRANSACTION_TIMEOUT"){
                              new swal(
                                'ðŸ™ï¸',
                                'Sorry the transaction, Timed Out',
                                'warning'
                            )
                        }
                    }

                    // document.location.reload();
                })
        }
    </script>




    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
</body>

</html>